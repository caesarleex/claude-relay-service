import{x as l,z as t,L as v,Q as L,ac as N,C as y,r as D,_ as f,q as E,y as i,K as U,P as p,O as b,S as V,aq as j}from"./vue-vendor-R8HMg95E.js";import{_ as O,c as w,s as n}from"./index-Co1phhrx.js";import"./element-plus-BQHxDbdW.js";import"./vendor-Dr8jvgFu.js";const K={name:"PromptsView",props:{embedded:{type:Boolean,default:!1}},setup(){const M=D([{id:"codex",name:"Codex CLI",description:"OpenAI Responses 服务的默认提示词",icon:"fas fa-code"},{id:"claudeCode",name:"Claude Code",description:"Claude Code 服务的默认提示词",icon:"fas fa-robot"},{id:"droid",name:"Droid",description:"Droid (Factory.ai) 服务的默认提示词",icon:"fas fa-wrench"}]),r=[{id:"manual",name:"手动编辑",icon:"fas fa-edit"},{id:"upload",name:"文件上传",icon:"fas fa-upload"},{id:"url",name:"URL 导入",icon:"fas fa-link"}],_=D(!1),o=f({codex:"",claudeCode:"",droid:""}),P=f({}),T=D({}),e=f({}),k=f({}),g=f({}),h=f({codex:"manual",claudeCode:"manual",droid:"manual"}),x=f({codex:"",claudeCode:"",droid:""}),d=f({codex:null,claudeCode:null,droid:null}),S=async()=>{try{const a=await w.get("/admin/prompts/meta/config");if(a.success){const s={};a.data.forEach(c=>{s[c.id]=c}),T.value=s}else n("加载配置元数据失败","error")}catch(a){console.error("Failed to load configs:",a),n("加载配置元数据失败","error")}},F=async()=>{_.value=!0;try{await S();for(const a of M.value){const s=await w.get(`/admin/prompts/${a.id}`);s.success&&(o[a.id]=s.content||"",P[a.id]={lastModified:s.lastModified,enabled:s.enabled,length:s.length})}}catch(a){console.error("Failed to load prompts:",a),n("加载 Prompts 失败","error")}finally{_.value=!1}},z=async a=>{var s,c;e[a]=!0;try{const u=await w.put(`/admin/prompts/${a}`,{content:o[a]});u.success?(n("保存成功","success"),await F()):n(u.error||"保存失败","error")}catch(u){console.error(`Failed to save ${a} prompt:`,u),n(((c=(s=u.response)==null?void 0:s.data)==null?void 0:c.error)||"保存失败","error")}finally{e[a]=!1}},H=()=>{const a=document.querySelector('input[type="file"][accept=".txt"]');a&&(a.value="",a.click())},q=async(a,s)=>{var u,m;const c=s.target.files[0];if(c){if(!c.name.endsWith(".txt")){n("仅支持 .txt 文件","error");return}if(c.size>1024*1024){n("文件大小不能超过 1MB","error");return}k[a]=!0;try{const C=new FormData;C.append("file",c);const B=await w.post(`/admin/prompts/${a}/upload`,C,{headers:{"Content-Type":"multipart/form-data"}});B.success?(n("上传成功","success"),await F(),h[a]="manual"):n(B.error||"上传失败","error")}catch(C){console.error(`Failed to upload ${a} prompt:`,C),n(((m=(u=C.response)==null?void 0:u.data)==null?void 0:m.error)||"上传失败","error")}finally{k[a]=!1}}},R=async a=>{var c,u;const s=x[a];if(s){if(!s.startsWith("https://")){n("仅支持 HTTPS 协议","error");return}g[a]=!0;try{const m=await w.post(`/admin/prompts/${a}/import-url`,{url:s,validate:!0});m.success?(d[a]=m.preview||m.content,n("预览加载成功","success")):n(m.error||"预览失败","error")}catch(m){console.error(`Failed to preview ${a} prompt:`,m),n(((u=(c=m.response)==null?void 0:c.data)==null?void 0:u.error)||"预览失败","error")}finally{g[a]=!1}}},W=async a=>{var c,u;const s=x[a];if(s){if(!s.startsWith("https://")){n("仅支持 HTTPS 协议","error");return}g[a]=!0;try{const m=await w.post(`/admin/prompts/${a}/import-url`,{url:s,validate:!1});m.success?(n("导入成功","success"),await F(),h[a]="manual",x[a]="",d[a]=null):n(m.error||"导入失败","error")}catch(m){console.error(`Failed to import ${a} prompt:`,m),n(((u=(c=m.response)==null?void 0:c.data)==null?void 0:u.error)||"导入失败","error")}finally{g[a]=!1}}},A=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return E(()=>{F()}),{services:M,editModes:r,loading:_,prompts:o,metadata:P,serviceConfigs:T,saving:e,uploading:k,importing:g,currentMode:h,importUrls:x,urlPreviews:d,savePrompt:z,triggerFileUpload:H,handleFileUpload:q,previewFromUrl:R,importFromUrl:W,formatDateTime:A}}},Q={class:"prompts-container"},G={key:0,class:"mb-4 sm:mb-6"},J={key:1,class:"py-12 text-center"},X={key:2,class:"space-y-6"},Y={class:"mb-4 flex items-center justify-between"},Z={class:"flex items-center"},I={class:"mr-3 flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 text-white"},$={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},tt={class:"text-sm text-gray-500 dark:text-gray-400"},et={class:"text-right"},ot={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},at={key:0,class:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-200"},rt={key:0,class:"mb-4 rounded-lg bg-blue-50 p-3 dark:bg-blue-900/20"},st={class:"flex items-start"},dt={class:"flex-1"},nt={class:"mt-1 text-xs text-blue-700 dark:text-blue-300"},lt={class:"rounded bg-blue-100 px-1.5 py-0.5 dark:bg-blue-800"},it={class:"ml-2"},ct={class:"mt-2 flex items-center text-xs"},mt={class:"mb-4"},ut={class:"flex space-x-4"},pt=["onClick"],gt=["onUpdate:modelValue","placeholder","rows"],ft={class:"mt-3 flex items-center justify-between"},xt={class:"text-xs text-gray-500 dark:text-gray-400"},yt={key:0},bt=["disabled","onClick"],_t={key:0,class:"loading-spinner mr-2"},kt={key:1,class:"fas fa-save mr-2"},ht={class:"rounded-lg bg-gray-50 p-6 dark:bg-gray-700"},wt=["onChange"],Ct=["disabled"],vt={key:0,class:"loading-spinner mr-2"},Ut={key:1,class:"fas fa-upload mr-2"},Ft={class:"space-y-3"},Mt=["for"],Pt=["id","onUpdate:modelValue"],Tt={class:"flex items-center space-x-3"},Dt=["disabled","onClick"],Vt=["disabled","onClick"],St={key:0,class:"loading-spinner mr-2"},Bt={key:1,class:"fas fa-download mr-2"},Lt={key:0,class:"mt-4 rounded-lg bg-gray-50 p-4 dark:bg-gray-700"},Nt={class:"mb-2 flex items-center justify-between"},jt=["onClick"],zt={class:"max-h-64 overflow-auto rounded border border-gray-200 bg-white p-3 text-xs dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300"};function Ht(M,r,_,o,P,T){return i(),l("div",Q,[t("div",{class:y(_.embedded?"":"card p-4 sm:p-6")},[_.embedded?v("",!0):(i(),l("div",G,r[1]||(r[1]=[t("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," System Prompts 管理 ",-1),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"}," 管理各服务的默认系统提示词 ",-1)]))),o.loading?(i(),l("div",J,r[2]||(r[2]=[t("div",{class:"loading-spinner mx-auto mb-4"},null,-1),t("p",{class:"text-gray-500 dark:text-gray-400"},"正在加载 Prompts...",-1)]))):(i(),l("div",X,[(i(!0),l(L,null,N(o.services,e=>{var k,g,h,x;return i(),l("div",{key:e.id,class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800 sm:p-6"},[t("div",Y,[t("div",Z,[t("div",I,[t("i",{class:y(["text-lg",e.icon])},null,2)]),t("div",null,[t("h3",$,p(e.name),1),t("p",tt,p(e.description),1)])]),t("div",et,[t("div",ot,[o.prompts[e.id]?(i(),l("span",at,p(o.prompts[e.id].length)+" 字符 ",1)):v("",!0)])])]),o.serviceConfigs[e.id]?(i(),l("div",rt,[t("div",st,[r[5]||(r[5]=t("i",{class:"fas fa-info-circle mr-2 mt-0.5 text-blue-600 dark:text-blue-400"},null,-1)),t("div",dt,[r[4]||(r[4]=t("div",{class:"text-sm font-medium text-blue-900 dark:text-blue-200"},"环境变量配置",-1)),t("div",nt,[t("code",lt,p(o.serviceConfigs[e.id].envVar||"N/A"),1),t("span",it,p(o.serviceConfigs[e.id].envDescription||""),1)]),t("div",ct,[r[3]||(r[3]=t("span",{class:"font-medium text-blue-900 dark:text-blue-200"},"当前状态:",-1)),t("span",{class:y(["ml-2 inline-flex items-center rounded-full px-2 py-0.5 font-medium",(k=o.metadata[e.id])!=null&&k.enabled?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"])},[t("i",{class:y(["mr-1 text-xs",(g=o.metadata[e.id])!=null&&g.enabled?"fas fa-check-circle":"fas fa-times-circle"])},null,2),b(" "+p((h=o.metadata[e.id])!=null&&h.enabled?"已启用":"已禁用"),1)],2)])])])])):v("",!0),t("div",mt,[t("nav",ut,[(i(!0),l(L,null,N(o.editModes,d=>(i(),l("button",{key:d.id,class:y(["rounded-lg px-3 py-2 text-sm font-medium transition-colors",o.currentMode[e.id]===d.id?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-200":"text-gray-600 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200"]),onClick:S=>o.currentMode[e.id]=d.id},[t("i",{class:y(["mr-2",d.icon])},null,2),b(" "+p(d.name),1)],10,pt))),128))])]),U(t("div",null,[U(t("textarea",{"onUpdate:modelValue":d=>o.prompts[e.id]=d,class:"form-input w-full font-mono text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",placeholder:`输入 ${e.name} 的 system prompt...`,rows:e.id==="codex"?25:3},null,8,gt),[[j,o.prompts[e.id]]]),t("div",ft,[t("div",xt,[(x=o.metadata[e.id])!=null&&x.lastModified?(i(),l("span",yt,[r[6]||(r[6]=t("i",{class:"fas fa-clock mr-1"},null,-1)),b(" 最后修改: "+p(o.formatDateTime(o.metadata[e.id].lastModified)),1)])):v("",!0)]),t("button",{class:y(["btn btn-primary px-4 py-2",{"cursor-not-allowed opacity-50":o.saving[e.id]}]),disabled:o.saving[e.id],onClick:d=>o.savePrompt(e.id)},[o.saving[e.id]?(i(),l("div",_t)):(i(),l("i",kt)),b(" "+p(o.saving[e.id]?"保存中...":"保存"),1)],10,bt)])],512),[[V,o.currentMode[e.id]==="manual"]]),U(t("div",null,[t("div",ht,[r[7]||(r[7]=t("div",{class:"mb-4 text-center"},[t("i",{class:"fas fa-upload mb-2 text-4xl text-gray-400 dark:text-gray-500"}),t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"支持 .txt 格式，最大 1MB")],-1)),t("input",{ref_for:!0,ref:`fileInput_${e.id}`,accept:".txt",class:"hidden",type:"file",onChange:d=>o.handleFileUpload(e.id,d)},null,40,wt),t("button",{class:"btn btn-success mx-auto block px-6 py-3",disabled:o.uploading[e.id],onClick:r[0]||(r[0]=d=>o.triggerFileUpload())},[o.uploading[e.id]?(i(),l("div",vt)):(i(),l("i",Ut)),b(" "+p(o.uploading[e.id]?"上传中...":"选择文件上传"),1)],8,Ct)])],512),[[V,o.currentMode[e.id]==="upload"]]),U(t("div",null,[t("div",Ft,[t("div",null,[t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",for:`url_${e.id}`}," HTTPS URL ",8,Mt),U(t("input",{id:`url_${e.id}`,"onUpdate:modelValue":d=>o.importUrls[e.id]=d,class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",placeholder:"https://example.com/prompt.txt",type:"url"},null,8,Pt),[[j,o.importUrls[e.id]]]),r[8]||(r[8]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 仅支持 HTTPS 协议，最大 1MB ",-1))]),t("div",Tt,[t("button",{class:"btn btn-primary px-4 py-2",disabled:!o.importUrls[e.id]||o.importing[e.id],onClick:d=>o.previewFromUrl(e.id)},r[9]||(r[9]=[t("i",{class:"fas fa-eye mr-2"},null,-1),b(" 预览 ",-1)]),8,Dt),t("button",{class:"btn btn-success px-4 py-2",disabled:!o.importUrls[e.id]||o.importing[e.id],onClick:d=>o.importFromUrl(e.id)},[o.importing[e.id]?(i(),l("div",St)):(i(),l("i",Bt)),b(" "+p(o.importing[e.id]?"导入中...":"直接导入"),1)],8,Vt)]),o.urlPreviews[e.id]?(i(),l("div",Lt,[t("div",Nt,[r[11]||(r[11]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"}," 预览内容 ",-1)),t("button",{class:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:d=>o.urlPreviews[e.id]=null},r[10]||(r[10]=[t("i",{class:"fas fa-times"},null,-1)]),8,jt)]),t("pre",zt,p(o.urlPreviews[e.id]),1)])):v("",!0)])],512),[[V,o.currentMode[e.id]==="url"]])])}),128))]))],2)])}const Et=O(K,[["render",Ht],["__scopeId","data-v-c1765934"]]);export{Et as default};
